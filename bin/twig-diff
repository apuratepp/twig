#!/usr/bin/env ruby

# Shows the diff between the given/current branch and its `diff-branch`.
#
# Subcommand for Twig: <http://rondevera.github.io/twig/>
# Author: Ron DeVera <http://rondevera.com>

args = ARGV.dup

branch_name = args.shift.strip if args.first[0, 1] != '-' # Use given branch
branch_name ||= `git rev-parse --abbrev-ref HEAD`.strip   # Use current branch

diff_branch  = `twig diff-branch -b "#{branch_name}"`.strip
diff_options = args.join(' ') # Pass remaining options to `git-diff`

abort if diff_branch.empty?

puts %{Getting diff of "#{branch_name}" against "#{diff_branch}"...}
exec %{git diff "#{diff_branch}" "#{branch_name}" #{diff_options}}
